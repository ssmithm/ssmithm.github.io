{
  "hash": "cbc282d51298fd709f49926ad6fd0029",
  "result": {
    "markdown": "---\ntitle: \"Time-to-follow-up Visualizations\"\nformat:\n  html:\n    include-in-header: \n      - includes/icons.html\n      - includes/analytics.html\n    fig-width: 7\n    fig-asp: 0.618\npage-layout: full\n---\n\n\n\nThis is an example of creating cumulative incidence curves for a time-to-event outcome. Here, we're using our Personal Hypertension Care project data from the OneFlorida research consortium. \n\nWe're using three packages:  `tidyverse`, `survival`, and `survminer`. \n\n## Data Prep\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(survminer)\n\n# data + a bit of cleaning/wrangling\nfu <- read_csv(\"/Users/stevensmith/Dropbox (UFL)/Manuscripts/K01/Early Patterns of Care/data/tfu_visualization.csv\",\n               show_col_types = FALSE) |> \n  rename_with(tolower) #|> \n#  replace_na(list(time_to_actual_sfu = 0))\n\n# recalculate time variable for patients w/o a second follow-up\n# fu <- fu |> \n#   mutate(t2fu = case_when(time_to_actual_ffu == 1 & \n#                             time_to_actual_sfu == 0 ~ 365 - t1fu, \n#                           TRUE ~ t2fu))\n\n# create a subset of patients with a first follow-up (for time-to-second\n# follow-up visit plot)\nfu2 <- fu |> filter(time_to_actual_ffu == 1)\n\n# create survival objects\nfut1 <- survfit(Surv(t1fu, time_to_actual_ffu) ~ source, data = fu)\nfut2 <- survfit(Surv(t2fu, time_to_actual_sfu) ~ source, data = fu2)\n\n# function for readibility\ncomma <- function(x) format(x, digits = 2, big.mark = \",\")\n```\n:::\n\n\n## Data\n\nWe have **64,586** Medicaid patients, and **52,712** Medicare patients. We intend to compare cumulative incidence of time-to-first follow-up (first hypertension-related visit) after starting hypertension therapy. Time 0 is date that they started antihypertensive treatment.   \n\n## Plotting time-to-first follow-up\n\nFirst, we create a cumulative incidence curve for time-to-first follow-up. The y-axis represents the cumulative proportion that had a first follow-up visit over time (x-axis). We're going to include Medicaid and Medicare on the same plot, as well as a formal comparison (w/ p-value), but if we don't want to directly compare the two, we could remove the p-value, or even split these up onto 2 figures. We're using the `ggsurvplot()` function from the *survminer* package. \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsurvplot(fut1, \n           data = fu, \n           fun = \"event\", \n           censor = FALSE,\n           pval = TRUE,    # set to FALSE if don't want p-value\n           pval.coord = c(270, 0.05),  # can delete this line if don't want p-value\n           risk.table = TRUE, \n           legend.title = \"Popn\", \n           legend.labs = c(\"Medicaid\", \"Medicare\"),\n           palette = c(\"#A7473A\", \"#4B5F6C\"), \n           break.time.by = 90, \n           xlab = \"Days from Initial Visit\", \n           ylab = \"Cumulative Incidence of Follow-up\",\n           axes.offset = TRUE,\n           ylim = c(0, 1),\n           tables.theme = theme_void(),\n           tables.height = 0.15,\n           tables.col = \"strata\",\n           surv.scale = \"percent\")\n```\n\n::: {.cell-output-display}\n![](cumulative_incidence_files/figure-html/T1FU_plot-1.png){fig-align='center' width=95%}\n:::\n:::\n\n\n\n## Time-to-second follow-up\n\nSame thing here, but now we are restricting this plot to the **28,304** Medicaid patients, and **14,608** Medicare patients that had a first-follow-up visit. And, time 0 on x-axis represents the time of their first follow-up visit, with the outcome being second follow-up visit.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsurvplot(fut2, \n           data = fu2, \n           fun = \"event\", \n           censor = FALSE,\n           pval = TRUE, \n           pval.coord = c(30, 0.8),\n           risk.table = TRUE, \n           legend.title = \"Popn\", \n           legend.labs = c(\"Medicaid\", \"Medicare\"),\n           palette = c(\"#A7473A\", \"#4B5F6C\"), \n           break.time.by = 90, \n           xlab = \"Days from First Follow-up\", \n           ylab = \"Cumulative Incidence of Second Follow-up\",\n           axes.offset = TRUE,\n           ylim = c(0, 1),\n           tables.theme = theme_void(),\n           tables.height = 0.15,\n           tables.col = \"strata\",\n           surv.scale = \"percent\")\n```\n\n::: {.cell-output-display}\n![](cumulative_incidence_files/figure-html/T2FU_plot-1.png){fig-align='center' width=95%}\n:::\n:::\n\n\n*These curves look surprisingly similar!* Particularly since there was a fairly stark difference in time-to-first follow-up. What to make of this?\n",
    "supporting": [
      "cumulative_incidence_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}